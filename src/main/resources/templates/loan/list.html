<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Loan List</title>
  <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>

<div th:replace="fragments/navbar :: navbar"></div>

<h1>Loan List</h1>
<a th:href="@{/loans/create}" class="create-button">+ Create New Loan</a>

<table class="loan-table">
  <thead>
  <tr>
    <th>User Email</th>
    <th>Book Title</th>
    <th>Issue Date</th>
    <th>Status</th>
    <th>Actions</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="loan : ${loans}">
    <td th:text="${loan.userEmail}"></td>
    <td th:text="${loan.bookTitle}"></td>
    <td th:text="${#temporals.format(loan.issueDate, 'yyyy-MM-dd')}"></td>
    <td th:text="${loan.status}"></td>
    <td>
      <a th:href="@{'/loans/' + ${loan.id}}">View</a>
      <span th:if="${canEdit}">
        |
        <a th:href="@{'/loans/' + ${loan.id} + '/edit'}">Edit</a>
      </span>
    </td>
    <td>
      <form th:action="@{/loans/{id}/notify(id=${loan.id})}" method="post">
        <button type="submit">Notify User</button>
      </form>
    </td>
    <td th:if="${notifiedId == loan.getId()}" class="success">
      Notification sent to user
    </td>
  </tr>
  </tbody>
</table>

</body>
</html>
